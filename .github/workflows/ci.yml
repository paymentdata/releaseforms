name: Go
on: [push]
jobs:

  build:
    name: Build
    runs-on: ubuntu-latest
    steps:

    - name: Set up Go 1.12
      uses: actions/setup-go@v1
      with:
        go-version: 1.12
      id: go
      
    - name: Check out code into the Go module directory
      uses: actions/checkout@v1
 
    - name: relocate src
      run: |
        mkdir -p /home/runner/go/src/github.com/paymentdata/releaseforms; cp -r . /home/runner/go/src/github.com/paymentdata/releaseforms

    - name: Get dependencies
      run: |
        cd ~/go/src/github.com/paymentdata/releaseforms
        go get -v -t -d ./...

    - name: Build
      run: cd ~/go/src/github.com/paymentdata/releaseforms; go build -v .
    
    - name: List Tests to Run
      run: cd ~/go/src/github.com/paymentdata/releaseforms; go test ./... -list '^(TestUnit*)' | grep -v "no test files\|^ok"
    
    - name: Run Unit Tests
      run: cd ~/go/src/github.com/paymentdata/releaseforms; go test ./... -v -cover -run '^(TestUnit*)'